<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 2.18.5"/><title data-react-helmet="true">Dive into AST</title><link as="script" rel="preload" href="/webpack-runtime-644e2f57be4c854484be.js"/><link as="script" rel="preload" href="/commons-317f25377a27bed135ec.js"/><link as="script" rel="preload" href="/app-36d5cee86ff0038b4e7b.js"/><link as="script" rel="preload" href="/component---gatsby-theme-mdx-deck-src-templates-deck-js-dd8d20199831c7ac1b73.js"/><link as="fetch" rel="preload" href="/page-data/print/page-data.json" crossorigin="anonymous"/></head><body><script>(function() { try {
        var mode = localStorage.getItem('theme-ui-color-mode');
        if (!mode) return
        document.body.classList.add('theme-ui-' + mode);
      } catch (e) {} })();</script><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><style data-emotion-css="13j5fvw">body{margin:0;}</style><style data-emotion-css="bdfrlc">.css-bdfrlc{width:100vw;height:100vh;}.css-bdfrlc *{box-sizing:border-box;}</style><div class="css-bdfrlc"><div style="outline:none;height:100%" tabindex="-1" role="group"><style data-emotion-css="gxvojt">.css-gxvojt{box-sizing:border-box;width:100%;height:100vh;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;overflow:hidden;position:relative;color:var(--theme-ui-colors-text,#9CDCFE);background-color:var(--theme-ui-colors-background,#1E1E1E);font-family:system-ui,sans-serif;font-size:20px;}@media screen and (min-width:40em){.css-gxvojt{font-size:24px;}}@media screen and (min-width:52em){.css-gxvojt{font-size:32px;}}@media screen and (min-width:64em){.css-gxvojt{font-size:48px;}}</style><div class="css-gxvojt"><style data-emotion-css="1djqpdg">.css-1djqpdg{font-family:inherit;line-height:1.125;font-weight:700;}</style><h1 class="css-1djqpdg">Dive into AST</h1></div><div class="css-gxvojt"><h2 class="css-1djqpdg">no-eval: 正規表現</h2><style data-emotion-css="1uk1gs8">.css-1uk1gs8{margin:0;}</style><ul class="css-1uk1gs8"><li class="css-0">正規表現で <style data-emotion-css="vgof0f">.css-vgof0f{font-family:"Roboto Mono",Menlo,monospace;}</style><code class="css-vgof0f">eval(?)</code> を使っているのを見つけるバリデーションを実装</li><li class="css-0"><code class="css-vgof0f">eval</code>があったら <code class="css-vgof0f">{ ok: false, error: { text: string, range: [number, number] }[] }</code> を返す</li></ul></div><div class="css-gxvojt"><div style="width:100vw;max-width:100%;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center" class="cs-layout"><div style="overflow:auto;height:100%;width:100%"><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><style data-emotion-css="oedec6">.css-oedec6{color:#9CDCFE;background-color:#1E1E1E;}.css-oedec6 .token-prolog{color:rgb(0,0,128);}.css-oedec6 .token-comment{color:rgb(106,153,85);}.css-oedec6 .token-builtin,.css-oedec6 .token-changed,.css-oedec6 .token-keyword{color:rgb(86,156,214);}.css-oedec6 .token-number,.css-oedec6 .token-inserted{color:rgb(181,206,168);}.css-oedec6 .token-constant{color:rgb(100,102,149);}.css-oedec6 .token-attr-name,.css-oedec6 .token-variable{color:rgb(156,220,254);}.css-oedec6 .token-deleted,.css-oedec6 .token-string,.css-oedec6 .token-attr-value{color:rgb(206,145,120);}.css-oedec6 .token-selector{color:rgb(215,186,125);}.css-oedec6 .token-tag{color:rgb(86,156,214);}.css-oedec6 .token-punctuation,.css-oedec6 .token-operator{color:rgb(212,212,212);}.css-oedec6 .token-punctuation{color:#808080;}.css-oedec6 .token-function{color:rgb(220,220,170);}.css-oedec6 .token-class-name{color:rgb(78,201,176);}.css-oedec6 .token-char{color:rgb(209,105,105);}</style><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><style data-emotion-css="xbe36b">.css-xbe36b{color:#9CDCFE;background-color:#1E1E1E;}</style><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-plain">module</span><span class="token-punctuation">.</span><span class="token-property-access">exports</span><span class="token-punctuation">.</span><span class="token-method-variable">noEval</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-parameter">code</span><span class="token-plain"> </span><span class="token-arrow">=&gt;</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-1"><span class="token-plain">    </span><span class="token-keyword">const</span><span class="token-plain"> pattern </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-regex">/eval\(.*?\)/g</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">    </span><span class="token-keyword">const</span><span class="token-plain"> errors </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-punctuation">]</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-plain">    </span><span class="token-keyword">let</span><span class="token-plain"> match </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-keyword">null</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-4"><span class="token-plain">    </span><span class="token-keyword">while</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-punctuation">(</span><span class="token-plain">match </span><span class="token-operator">=</span><span class="token-plain"> pattern</span><span class="token-punctuation">.</span><span class="token-method">exec</span><span class="token-punctuation">(</span><span class="token-plain">code</span><span class="token-punctuation">)</span><span class="token-punctuation">)</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">        errors</span><span class="token-punctuation">.</span><span class="token-method">push</span><span class="token-punctuation">(</span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">            text</span><span class="token-punctuation">:</span><span class="token-plain"> code</span><span class="token-punctuation">.</span><span class="token-method">slice</span><span class="token-punctuation">(</span><span class="token-plain">match</span><span class="token-punctuation">.</span><span class="token-property-access">index</span><span class="token-punctuation">,</span><span class="token-plain"> pattern</span><span class="token-punctuation">.</span><span class="token-property-access">lastIndex</span><span class="token-punctuation">)</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-7"><span class="token-plain">            range</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-plain">match</span><span class="token-punctuation">.</span><span class="token-property-access">index</span><span class="token-punctuation">,</span><span class="token-plain"> pattern</span><span class="token-punctuation">.</span><span class="token-property-access">lastIndex</span><span class="token-punctuation">]</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-plain">        </span><span class="token-punctuation">}</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-9"><span class="token-plain">    </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-10"><span class="token-plain">    </span><span class="token-keyword">return</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-11"><span class="token-plain">        ok</span><span class="token-punctuation">:</span><span class="token-plain"> errors</span><span class="token-punctuation">.</span><span class="token-property-access">length</span><span class="token-plain"> </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-number">0</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-plain">        errors</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-plain">    </span><span class="token-punctuation">}</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-punctuation">}</span><span class="token-punctuation">;</span></div></div><div></div></code></pre><style data-emotion-css="1q54swq">.css-1q54swq{position:absolute;top:0;width:100%;margin:0;padding:1em 0;text-align:center;background-color:#1E1E1E;color:#9CDCFE;}</style><h4 class="cs-title css-1q54swq" style="opacity:1"><span style="opacity:1">no-eval: 正規表現での実装</span></h4><style data-emotion-css="fs2d1k">.css-fs2d1k{position:absolute;bottom:0;width:calc(100% - 2em);box-sizing:border-box;margin:0.3em 1em;padding:0.5em;background:rgba(2,2,2,0.9);text-align:center;color:#d6deeb;background-color:rgba(10,10,10,0.9);}</style><p class="cs-subtitle css-fs2d1k" style="opacity:0"><span style="opacity:1"></span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">            text</span><span class="token-punctuation">:</span><span class="token-plain"> code</span><span class="token-punctuation">.</span><span class="token-method">slice</span><span class="token-punctuation">(</span><span class="token-plain">match</span><span class="token-punctuation">.</span><span class="token-property-access">index</span><span class="token-punctuation">,</span><span class="token-plain"> pattern</span><span class="token-punctuation">.</span><span class="token-property-access">lastIndex</span><span class="token-punctuation">)</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-plain">        errors</span></div></div><div></div></code></pre><p class="cs-subtitle css-fs2d1k"><span style="opacity:1">evalにマッチするパターン</span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">            text</span><span class="token-punctuation">:</span><span class="token-plain"> code</span><span class="token-punctuation">.</span><span class="token-method">slice</span><span class="token-punctuation">(</span><span class="token-plain">match</span><span class="token-punctuation">.</span><span class="token-property-access">index</span><span class="token-punctuation">,</span><span class="token-plain"> pattern</span><span class="token-punctuation">.</span><span class="token-property-access">lastIndex</span><span class="token-punctuation">)</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-plain">        errors</span></div></div><div></div></code></pre><p class="cs-subtitle css-fs2d1k"><span style="opacity:1">パターンにマッチした部分を見つけたらエラー結果に追加</span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">            text</span><span class="token-punctuation">:</span><span class="token-plain"> code</span><span class="token-punctuation">.</span><span class="token-method">slice</span><span class="token-punctuation">(</span><span class="token-plain">match</span><span class="token-punctuation">.</span><span class="token-property-access">index</span><span class="token-punctuation">,</span><span class="token-plain"> pattern</span><span class="token-punctuation">.</span><span class="token-property-access">lastIndex</span><span class="token-punctuation">)</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-plain">        errors</span></div></div><div></div></code></pre><p class="cs-subtitle css-fs2d1k" style="opacity:1"><span style="opacity:1">エラー結果があるならok:falseを返す</span></p></div></div></div></div></div><div class="css-gxvojt"><div style="width:100vw;max-width:100%;height:100vh;display:flex;flex-direction:row;justify-content:center;align-items:center;font-size:0.8em;position:relative" class="cs-col-layout"><div style="flex:1;overflow:hidden;height:100%"><div style="overflow:auto;height:100%;width:100%"><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-plain">module</span><span class="token-punctuation">.</span><span class="token-property-access">exports</span><span class="token-punctuation">.</span><span class="token-method-variable">noEval</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-parameter">code</span><span class="token-plain"> </span><span class="token-arrow">=&gt;</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-1"><span class="token-plain">    </span><span class="token-keyword">const</span><span class="token-plain"> pattern </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-regex">/eval\(.*?\)/g</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">    </span><span class="token-keyword">const</span><span class="token-plain"> errors </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-punctuation">]</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-plain">    </span><span class="token-keyword">let</span><span class="token-plain"> match </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-keyword">null</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-4"><span class="token-plain">    </span><span class="token-keyword">while</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-punctuation">(</span><span class="token-plain">match </span><span class="token-operator">=</span><span class="token-plain"> pattern</span><span class="token-punctuation">.</span><span class="token-method">exec</span><span class="token-punctuation">(</span><span class="token-plain">code</span><span class="token-punctuation">)</span><span class="token-punctuation">)</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">        errors</span><span class="token-punctuation">.</span><span class="token-method">push</span><span class="token-punctuation">(</span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">            text</span><span class="token-punctuation">:</span><span class="token-plain"> code</span><span class="token-punctuation">.</span><span class="token-method">slice</span><span class="token-punctuation">(</span><span class="token-plain">match</span><span class="token-punctuation">.</span><span class="token-property-access">index</span><span class="token-punctuation">,</span><span class="token-plain"> pattern</span><span class="token-punctuation">.</span><span class="token-property-access">lastIndex</span><span class="token-punctuation">)</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-7"><span class="token-plain">            range</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-plain">match</span><span class="token-punctuation">.</span><span class="token-property-access">index</span><span class="token-punctuation">,</span><span class="token-plain"> pattern</span><span class="token-punctuation">.</span><span class="token-property-access">lastIndex</span><span class="token-punctuation">]</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-plain">        </span><span class="token-punctuation">}</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-9"><span class="token-plain">    </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-10"><span class="token-plain">    </span><span class="token-keyword">return</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-11"><span class="token-plain">        ok</span><span class="token-punctuation">:</span><span class="token-plain"> errors</span><span class="token-punctuation">.</span><span class="token-property-access">length</span><span class="token-plain"> </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-number">0</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-plain">        errors</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-plain">    </span><span class="token-punctuation">}</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-punctuation">}</span><span class="token-punctuation">;</span></div></div><div></div></code></pre><h4 class="cs-title css-1q54swq"><span>実装</span></h4></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">            text</span><span class="token-punctuation">:</span><span class="token-plain"> code</span><span class="token-punctuation">.</span><span class="token-method">slice</span><span class="token-punctuation">(</span><span class="token-plain">match</span><span class="token-punctuation">.</span><span class="token-property-access">index</span><span class="token-punctuation">,</span><span class="token-plain"> pattern</span><span class="token-punctuation">.</span><span class="token-property-access">lastIndex</span><span class="token-punctuation">)</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-plain">        errors</span></div></div><div></div></code></pre><h4 class="cs-title css-1q54swq"><span>実装</span></h4></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">            text</span><span class="token-punctuation">:</span><span class="token-plain"> code</span><span class="token-punctuation">.</span><span class="token-method">slice</span><span class="token-punctuation">(</span><span class="token-plain">match</span><span class="token-punctuation">.</span><span class="token-property-access">index</span><span class="token-punctuation">,</span><span class="token-plain"> pattern</span><span class="token-punctuation">.</span><span class="token-property-access">lastIndex</span><span class="token-punctuation">)</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-plain">        errors</span></div></div><div></div></code></pre><h4 class="cs-title css-1q54swq"><span>実装</span></h4><p class="cs-subtitle css-fs2d1k" style="opacity:0"><span style="opacity:1"></span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">            text</span><span class="token-punctuation">:</span><span class="token-plain"> code</span><span class="token-punctuation">.</span><span class="token-method">slice</span><span class="token-punctuation">(</span><span class="token-plain">match</span><span class="token-punctuation">.</span><span class="token-property-access">index</span><span class="token-punctuation">,</span><span class="token-plain"> pattern</span><span class="token-punctuation">.</span><span class="token-property-access">lastIndex</span><span class="token-punctuation">)</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-plain">        errors</span></div></div><div></div></code></pre><h4 class="cs-title css-1q54swq" style="opacity:1"><span style="opacity:1">実装</span></h4><p class="cs-subtitle css-fs2d1k" style="opacity:1"><span style="opacity:1">正規表現だけではコメント内かは判断できない</span></p></div></div></div></div><div style="flex:1;overflow:hidden;height:100%"><div style="overflow:auto;height:100%;width:100%"><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><style data-emotion-css="n2kuek">.css-n2kuek{color:#393A34;background-color:#f6f8fa;}.css-n2kuek .token-prolog{color:rgb(0,0,128);}.css-n2kuek .token-comment{color:rgb(106,153,85);}.css-n2kuek .token-builtin,.css-n2kuek .token-changed,.css-n2kuek .token-keyword{color:rgb(86,156,214);}.css-n2kuek .token-number,.css-n2kuek .token-inserted{color:rgb(181,206,168);}.css-n2kuek .token-constant{color:rgb(100,102,149);}.css-n2kuek .token-attr-name,.css-n2kuek .token-variable{color:rgb(156,220,254);}.css-n2kuek .token-deleted,.css-n2kuek .token-string,.css-n2kuek .token-attr-value{color:rgb(206,145,120);}.css-n2kuek .token-selector{color:rgb(215,186,125);}.css-n2kuek .token-tag{color:rgb(86,156,214);}.css-n2kuek .token-punctuation,.css-n2kuek .token-operator{color:#393A34;}.css-n2kuek .token-punctuation{color:#808080;}.css-n2kuek .token-function{color:rgb(220,220,170);}.css-n2kuek .token-class-name{color:rgb(78,201,176);}.css-n2kuek .token-char{color:rgb(209,105,105);}.css-n2kuek .token-comment,.css-n2kuek .token-prolog,.css-n2kuek .token-doctype,.css-n2kuek .token-cdata{color:#999988;font-style:italic;}.css-n2kuek .token-namespace{opacity:0.7;}.css-n2kuek .token-string,.css-n2kuek .token-attr-value{color:#e3116c;}.css-n2kuek .token-entity,.css-n2kuek .token-url,.css-n2kuek .token-symbol,.css-n2kuek .token-number,.css-n2kuek .token-boolean,.css-n2kuek .token-variable,.css-n2kuek .token-constant,.css-n2kuek .token-property,.css-n2kuek .token-regex,.css-n2kuek .token-inserted{color:#36acaa;}.css-n2kuek .token-atrule,.css-n2kuek .token-keyword,.css-n2kuek .token-attr-name,.css-n2kuek .token-selector{color:#00a4db;}.css-n2kuek .token-function,.css-n2kuek .token-deleted,.css-n2kuek .token-tag{color:#d73a49;}.css-n2kuek .token-function-variable{color:#6f42c1;}.css-n2kuek .token-tag,.css-n2kuek .token-selector{color:#00009f;}</style><pre class="cs-content css-n2kuek" style="margin:0;height:100%;overflow:hidden"><style data-emotion-css="xdak34">.css-xdak34{color:#393A34;background-color:#f6f8fa;}</style><code class="cs-scaled-content css-xdak34" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">const</span><span class="token-plain"> assert </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">require</span><span class="token-punctuation">(</span><span class="token-string">&quot;assert&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-1"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-punctuation">{</span><span class="token-plain"> noEval </span><span class="token-punctuation">}</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">require</span><span class="token-punctuation">(</span><span class="token-string">&quot;./index&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-comment">// 上手くevalを判定できるパターン</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-keyword">const</span><span class="token-plain"> validationResult </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">noEval</span><span class="token-punctuation">(</span><span class="token-template-punctuation">`</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-4"><span class="token-string">eval(1+1);</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-template-punctuation">`</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">assert</span><span class="token-punctuation">.</span><span class="token-method">deepStrictEqual</span><span class="token-punctuation">(</span><span class="token-plain">validationResult</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-7"><span class="token-plain">    ok</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-boolean">false</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-plain">    errors</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-punctuation">{</span><span class="token-plain"> text</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-string">&quot;eval(1+1)&quot;</span><span class="token-punctuation">,</span><span class="token-plain"> range</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-number">1</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-number">10</span><span class="token-punctuation">]</span><span class="token-plain"> </span><span class="token-punctuation">}</span><span class="token-punctuation">]</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-9"><span class="token-punctuation">}</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-10"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-11"><span class="token-comment">// コメントのevalを誤検知してるパターン</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-keyword">const</span><span class="token-plain"> validationResult2 </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">noEval</span><span class="token-punctuation">(</span><span class="token-template-punctuation">`</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-string">// eval(1+1); &lt;= THIS IS COMMENT</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-template-punctuation">`</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-15"><span class="token-plain">assert</span><span class="token-punctuation">.</span><span class="token-method">deepStrictEqual</span><span class="token-punctuation">(</span><span class="token-plain">validationResult2</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-16"><span class="token-plain">    ok</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-boolean">false</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-17"><span class="token-plain">    errors</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-punctuation">{</span><span class="token-plain"> text</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-string">&quot;eval(1+1)&quot;</span><span class="token-punctuation">,</span><span class="token-plain"> range</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-number">4</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-number">13</span><span class="token-punctuation">]</span><span class="token-plain"> </span><span class="token-punctuation">}</span><span class="token-punctuation">]</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-18"><span class="token-punctuation">}</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div></div></code></pre><style data-emotion-css="1xose5o">.css-1xose5o{position:absolute;top:0;width:100%;margin:0;padding:1em 0;text-align:center;background-color:#f6f8fa;color:#393A34;}</style><h4 class="cs-title css-1xose5o"><span>テスト</span></h4><p class="cs-subtitle css-fs2d1k" style="opacity:0"><span style="opacity:1"></span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-n2kuek" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xdak34" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-comment">// 上手くevalを判定できるパターン</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-plain">    errors</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-punctuation">{</span><span class="token-plain"> text</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-string">&quot;eval(1+1)&quot;</span><span class="token-punctuation">,</span><span class="token-plain"> range</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-number">1</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-number">10</span><span class="token-punctuation">]</span><span class="token-plain"> </span><span class="token-punctuation">}</span><span class="token-punctuation">]</span></div></div><div></div></code></pre><h4 class="cs-title css-1xose5o"><span>テスト</span></h4><p class="cs-subtitle css-fs2d1k"><span style="opacity:1">上手く判定できてるパターン</span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-n2kuek" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xdak34" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-comment">// 上手くevalを判定できるパターン</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-plain">    errors</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-punctuation">{</span><span class="token-plain"> text</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-string">&quot;eval(1+1)&quot;</span><span class="token-punctuation">,</span><span class="token-plain"> range</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-number">1</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-number">10</span><span class="token-punctuation">]</span><span class="token-plain"> </span><span class="token-punctuation">}</span><span class="token-punctuation">]</span></div></div><div></div></code></pre><h4 class="cs-title css-1xose5o"><span>テスト</span></h4><p class="cs-subtitle css-fs2d1k"><span>誤検知しているパターン</span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-n2kuek" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xdak34" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-comment">// 上手くevalを判定できるパターン</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-plain">    errors</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-punctuation">{</span><span class="token-plain"> text</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-string">&quot;eval(1+1)&quot;</span><span class="token-punctuation">,</span><span class="token-plain"> range</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-number">1</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-number">10</span><span class="token-punctuation">]</span><span class="token-plain"> </span><span class="token-punctuation">}</span><span class="token-punctuation">]</span></div></div><div></div></code></pre><h4 class="cs-title css-1xose5o" style="opacity:1"><span style="opacity:1">テスト</span></h4><p class="cs-subtitle css-fs2d1k" style="opacity:1"><span style="opacity:1">誤検知しているパターン</span></p></div></div></div></div></div></div><div class="css-gxvojt"><h2 class="css-1djqpdg">no-eval: 正規表現の問題</h2><ul class="css-1uk1gs8"><li class="css-0">正規表現は簡単だが問題を2つに増やす</li><li class="css-0">コメント中やスペースの有無には対応しにくい</li><li class="css-0">正規表現でソースコードのような柔軟なものはマッチするのが困難</li><li class="css-0">ブラックリストの実装は抜けが多くなりやすい</li><li class="css-0">ホワイトリストの実装は正規表現がやりやすい</li></ul></div><div class="css-gxvojt"><h2 class="css-1djqpdg">no-eval: AST</h2><ul class="css-1uk1gs8"><li class="css-0">ASTを使って同じno-evalを実装する</li><li class="css-0">パーサには<style data-emotion-css="199bzt4">.css-199bzt4{color:var(--theme-ui-colors-primary,rgb(206,145,120));}</style><a href="https://github.com/acornjs/acorn" class="css-199bzt4">acorn</a>、Traversalには<a href="https://github.com/Rich-Harris/estree-walker" class="css-199bzt4">estree-walker</a></li></ul></div><div class="css-gxvojt"><div style="width:100vw;max-width:100%;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center" class="cs-layout"><div style="overflow:auto;height:100%;width:100%"><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-punctuation">{</span><span class="token-plain"> parse </span><span class="token-punctuation">}</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">require</span><span class="token-punctuation">(</span><span class="token-string">&quot;acorn&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-1"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-punctuation">{</span><span class="token-plain"> walk </span><span class="token-punctuation">}</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">require</span><span class="token-punctuation">(</span><span class="token-string">&quot;estree-walker&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-plain">module</span><span class="token-punctuation">.</span><span class="token-property-access">exports</span><span class="token-punctuation">.</span><span class="token-method-variable">validate</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-parameter">code</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-4"><span class="token-plain">    </span><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-constant">AST</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">parse</span><span class="token-punctuation">(</span><span class="token-plain">code</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-punctuation">{</span><span class="token-plain"> range</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-boolean">true</span><span class="token-plain"> </span><span class="token-punctuation">}</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">    </span><span class="token-keyword">const</span><span class="token-plain"> errors </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-punctuation">]</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">    </span><span class="token-function">walk</span><span class="token-punctuation">(</span><span class="token-constant">AST</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-7"><span class="token-plain">        </span><span class="token-function">enter</span><span class="token-punctuation">(</span><span class="token-parameter">node</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-plain">            </span><span class="token-keyword">const</span><span class="token-plain"> isEval </span><span class="token-operator">=</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-9"><span class="token-plain">                node</span><span class="token-punctuation">.</span><span class="token-property-access">type</span><span class="token-plain"> </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;CallExpression&quot;</span><span class="token-plain"> </span><span class="token-operator">&amp;&amp;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-10"><span class="token-plain">                node</span><span class="token-punctuation">.</span><span class="token-property-access">callee</span><span class="token-plain"> </span><span class="token-operator">&amp;&amp;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-11"><span class="token-plain">                node</span><span class="token-punctuation">.</span><span class="token-property-access">callee</span><span class="token-punctuation">.</span><span class="token-property-access">type</span><span class="token-plain"> </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;Identifier&quot;</span><span class="token-plain"> </span><span class="token-operator">&amp;&amp;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-plain">                node</span><span class="token-punctuation">.</span><span class="token-property-access">callee</span><span class="token-punctuation">.</span><span class="token-property-access">name</span><span class="token-plain"> </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;eval&quot;</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-plain">            </span><span class="token-keyword">if</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-plain">isEval</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-plain">                errors</span><span class="token-punctuation">.</span><span class="token-method">push</span><span class="token-punctuation">(</span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-15"><span class="token-plain">                    range</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-plain">node</span><span class="token-punctuation">.</span><span class="token-property-access">start</span><span class="token-punctuation">,</span><span class="token-plain"> node</span><span class="token-punctuation">.</span><span class="token-property-access">end</span><span class="token-punctuation">]</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-16"><span class="token-plain">                    text</span><span class="token-punctuation">:</span><span class="token-plain"> code</span><span class="token-punctuation">.</span><span class="token-method">slice</span><span class="token-punctuation">(</span><span class="token-plain">node</span><span class="token-punctuation">.</span><span class="token-property-access">start</span><span class="token-punctuation">,</span><span class="token-plain"> node</span><span class="token-punctuation">.</span><span class="token-property-access">end</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-17"><span class="token-plain">                </span><span class="token-punctuation">}</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-18"><span class="token-plain">            </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-19"><span class="token-plain">        </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-20"><span class="token-plain">    </span><span class="token-punctuation">}</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-21"><span class="token-plain">    </span><span class="token-keyword">return</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-22"><span class="token-plain">        ok</span><span class="token-punctuation">:</span><span class="token-plain"> errors</span><span class="token-punctuation">.</span><span class="token-property-access">length</span><span class="token-plain"> </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-number">0</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-23"><span class="token-plain">        errors</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-24"><span class="token-plain">    </span><span class="token-punctuation">}</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-25"><span class="token-punctuation">}</span><span class="token-punctuation">;</span></div></div><div></div></code></pre><h4 class="cs-title css-1q54swq" style="opacity:1"><span style="opacity:1">no-eval: ASTでの実装</span></h4><p class="cs-subtitle css-fs2d1k" style="opacity:0"><span style="opacity:1"></span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">​</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-16"><span class="token-plain">                    text</span><span class="token-punctuation">:</span><span class="token-plain"> code</span><span class="token-punctuation">.</span><span class="token-method">slice</span><span class="token-punctuation">(</span><span class="token-plain">node</span><span class="token-punctuation">.</span><span class="token-property-access">start</span><span class="token-punctuation">,</span><span class="token-plain"> node</span><span class="token-punctuation">.</span><span class="token-property-access">end</span><span class="token-punctuation">)</span></div></div><div></div></code></pre><p class="cs-subtitle css-fs2d1k"><span style="opacity:1">コードをASTにパースする</span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">​</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-16"><span class="token-plain">                    text</span><span class="token-punctuation">:</span><span class="token-plain"> code</span><span class="token-punctuation">.</span><span class="token-method">slice</span><span class="token-punctuation">(</span><span class="token-plain">node</span><span class="token-punctuation">.</span><span class="token-property-access">start</span><span class="token-punctuation">,</span><span class="token-plain"> node</span><span class="token-punctuation">.</span><span class="token-property-access">end</span><span class="token-punctuation">)</span></div></div><div></div></code></pre><p class="cs-subtitle css-fs2d1k"><span style="opacity:1">ASTをトラバースし、各Nodeごとに判定処理</span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">​</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-16"><span class="token-plain">                    text</span><span class="token-punctuation">:</span><span class="token-plain"> code</span><span class="token-punctuation">.</span><span class="token-method">slice</span><span class="token-punctuation">(</span><span class="token-plain">node</span><span class="token-punctuation">.</span><span class="token-property-access">start</span><span class="token-punctuation">,</span><span class="token-plain"> node</span><span class="token-punctuation">.</span><span class="token-property-access">end</span><span class="token-punctuation">)</span></div></div><div></div></code></pre><p class="cs-subtitle css-fs2d1k"><span style="opacity:1">Nodeがeval呼び出しかを判定</span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">​</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-16"><span class="token-plain">                    text</span><span class="token-punctuation">:</span><span class="token-plain"> code</span><span class="token-punctuation">.</span><span class="token-method">slice</span><span class="token-punctuation">(</span><span class="token-plain">node</span><span class="token-punctuation">.</span><span class="token-property-access">start</span><span class="token-punctuation">,</span><span class="token-plain"> node</span><span class="token-punctuation">.</span><span class="token-property-access">end</span><span class="token-punctuation">)</span></div></div><div></div></code></pre><p class="cs-subtitle css-fs2d1k"><span style="opacity:1">isEval: 関数呼び出しで名前がevalかを判定</span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">​</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-16"><span class="token-plain">                    text</span><span class="token-punctuation">:</span><span class="token-plain"> code</span><span class="token-punctuation">.</span><span class="token-method">slice</span><span class="token-punctuation">(</span><span class="token-plain">node</span><span class="token-punctuation">.</span><span class="token-property-access">start</span><span class="token-punctuation">,</span><span class="token-plain"> node</span><span class="token-punctuation">.</span><span class="token-property-access">end</span><span class="token-punctuation">)</span></div></div><div></div></code></pre><p class="cs-subtitle css-fs2d1k"><span style="opacity:1">evalだったらエラー結果に追加</span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-16"><span class="token-plain">                    text</span><span class="token-punctuation">:</span><span class="token-plain"> code</span><span class="token-punctuation">.</span><span class="token-method">slice</span><span class="token-punctuation">(</span><span class="token-plain">node</span><span class="token-punctuation">.</span><span class="token-property-access">start</span><span class="token-punctuation">,</span><span class="token-plain"> node</span><span class="token-punctuation">.</span><span class="token-property-access">end</span><span class="token-punctuation">)</span></div></div><div></div></code></pre><p class="cs-subtitle css-fs2d1k" style="opacity:1"><span style="opacity:1">エラーがあったらok:falseを返す</span></p></div></div></div></div></div><div class="css-gxvojt"><div style="width:100vw;max-width:100%;height:100vh;display:flex;flex-direction:row;justify-content:center;align-items:center;font-size:0.8em;position:relative" class="cs-col-layout"><div style="flex:1;overflow:hidden;height:100%"><div style="overflow:auto;height:100%;width:100%"><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-punctuation">{</span><span class="token-plain"> parse </span><span class="token-punctuation">}</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">require</span><span class="token-punctuation">(</span><span class="token-string">&quot;acorn&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-1"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-punctuation">{</span><span class="token-plain"> walk </span><span class="token-punctuation">}</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">require</span><span class="token-punctuation">(</span><span class="token-string">&quot;estree-walker&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-plain">module</span><span class="token-punctuation">.</span><span class="token-property-access">exports</span><span class="token-punctuation">.</span><span class="token-method-variable">validate</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-parameter">code</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-4"><span class="token-plain">    </span><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-constant">AST</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">parse</span><span class="token-punctuation">(</span><span class="token-plain">code</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-punctuation">{</span><span class="token-plain"> range</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-boolean">true</span><span class="token-plain"> </span><span class="token-punctuation">}</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">    </span><span class="token-keyword">const</span><span class="token-plain"> errors </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-punctuation">]</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">    </span><span class="token-function">walk</span><span class="token-punctuation">(</span><span class="token-constant">AST</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-7"><span class="token-plain">        </span><span class="token-function">enter</span><span class="token-punctuation">(</span><span class="token-parameter">node</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-plain">            </span><span class="token-keyword">const</span><span class="token-plain"> isEval </span><span class="token-operator">=</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-9"><span class="token-plain">                node</span><span class="token-punctuation">.</span><span class="token-property-access">type</span><span class="token-plain"> </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;CallExpression&quot;</span><span class="token-plain"> </span><span class="token-operator">&amp;&amp;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-10"><span class="token-plain">                node</span><span class="token-punctuation">.</span><span class="token-property-access">callee</span><span class="token-plain"> </span><span class="token-operator">&amp;&amp;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-11"><span class="token-plain">                node</span><span class="token-punctuation">.</span><span class="token-property-access">callee</span><span class="token-punctuation">.</span><span class="token-property-access">type</span><span class="token-plain"> </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;Identifier&quot;</span><span class="token-plain"> </span><span class="token-operator">&amp;&amp;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-plain">                node</span><span class="token-punctuation">.</span><span class="token-property-access">callee</span><span class="token-punctuation">.</span><span class="token-property-access">name</span><span class="token-plain"> </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;eval&quot;</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-plain">            </span><span class="token-keyword">if</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-plain">isEval</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-plain">                errors</span><span class="token-punctuation">.</span><span class="token-method">push</span><span class="token-punctuation">(</span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-15"><span class="token-plain">                    range</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-plain">node</span><span class="token-punctuation">.</span><span class="token-property-access">start</span><span class="token-punctuation">,</span><span class="token-plain"> node</span><span class="token-punctuation">.</span><span class="token-property-access">end</span><span class="token-punctuation">]</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden"><div style="display:inline-block" class="cs-line cs-line-16"><span class="token-plain">                    text</span><span class="token-punctuation">:</span><span class="token-plain"> code</span><span class="token-punctuation">.</span><span class="token-method">slice</span><span class="token-punctuation">(</span><span class="token-plain">node</span><span class="token-punctuation">.</span><span class="token-property-access">start</span><span class="token-punctuation">,</span><span class="token-plain"> node</span><span class="token-punctuation">.</span><span class="token-property-access">end</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-17"><span class="token-plain">                </span><span class="token-punctuation">}</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-18"><span class="token-plain">            </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-19"><span class="token-plain">        </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-20"><span class="token-plain">    </span><span class="token-punctuation">}</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-21"><span class="token-plain">    </span><span class="token-keyword">return</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-22"><span class="token-plain">        ok</span><span class="token-punctuation">:</span><span class="token-plain"> errors</span><span class="token-punctuation">.</span><span class="token-property-access">length</span><span class="token-plain"> </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-number">0</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-23"><span class="token-plain">        errors</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-24"><span class="token-plain">    </span><span class="token-punctuation">}</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-25"><span class="token-punctuation">}</span><span class="token-punctuation">;</span></div></div><div></div></code></pre><h4 class="cs-title css-1q54swq"><span>実装</span></h4></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">​</span></div></div><div style="overflow:hidden"><div style="display:inline-block" class="cs-line cs-line-16"><span class="token-plain">                    text</span><span class="token-punctuation">:</span><span class="token-plain"> code</span><span class="token-punctuation">.</span><span class="token-method">slice</span><span class="token-punctuation">(</span><span class="token-plain">node</span><span class="token-punctuation">.</span><span class="token-property-access">start</span><span class="token-punctuation">,</span><span class="token-plain"> node</span><span class="token-punctuation">.</span><span class="token-property-access">end</span><span class="token-punctuation">)</span></div></div><div></div></code></pre><h4 class="cs-title css-1q54swq"><span>実装</span></h4></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">​</span></div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-16"><span class="token-plain">                    text</span><span class="token-punctuation">:</span><span class="token-plain"> code</span><span class="token-punctuation">.</span><span class="token-method">slice</span><span class="token-punctuation">(</span><span class="token-plain">node</span><span class="token-punctuation">.</span><span class="token-property-access">start</span><span class="token-punctuation">,</span><span class="token-plain"> node</span><span class="token-punctuation">.</span><span class="token-property-access">end</span><span class="token-punctuation">)</span></div></div><div></div></code></pre><h4 class="cs-title css-1q54swq"><span>実装</span></h4><p class="cs-subtitle css-fs2d1k" style="opacity:0"><span style="opacity:1"></span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-16"><span class="token-plain">                    text</span><span class="token-punctuation">:</span><span class="token-plain"> code</span><span class="token-punctuation">.</span><span class="token-method">slice</span><span class="token-punctuation">(</span><span class="token-plain">node</span><span class="token-punctuation">.</span><span class="token-property-access">start</span><span class="token-punctuation">,</span><span class="token-plain"> node</span><span class="token-punctuation">.</span><span class="token-property-access">end</span><span class="token-punctuation">)</span></div></div><div></div></code></pre><h4 class="cs-title css-1q54swq" style="opacity:1"><span style="opacity:1">実装</span></h4><p class="cs-subtitle css-fs2d1k" style="opacity:1"><span style="opacity:1">CallExpressionかを判定するため</span></p></div></div></div></div><div style="flex:1;overflow:hidden;height:100%"><div style="overflow:auto;height:100%;width:100%"><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-n2kuek" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xdak34" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">const</span><span class="token-plain"> assert </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">require</span><span class="token-punctuation">(</span><span class="token-string">&quot;assert&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-1"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-punctuation">{</span><span class="token-plain"> validate </span><span class="token-punctuation">}</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">require</span><span class="token-punctuation">(</span><span class="token-string">&quot;./index&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-comment">// eval呼び出しを判定できてる</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-keyword">const</span><span class="token-plain"> validationResult </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">validate</span><span class="token-punctuation">(</span><span class="token-template-punctuation">`</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-4"><span class="token-string">eval(1+1);</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-template-punctuation">`</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">assert</span><span class="token-punctuation">.</span><span class="token-method">deepStrictEqual</span><span class="token-punctuation">(</span><span class="token-plain">validationResult</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-7"><span class="token-plain">    ok</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-boolean">false</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-plain">    errors</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-punctuation">{</span><span class="token-plain"> text</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-string">&quot;eval(1+1)&quot;</span><span class="token-punctuation">,</span><span class="token-plain"> range</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-number">1</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-number">10</span><span class="token-punctuation">]</span><span class="token-plain"> </span><span class="token-punctuation">}</span><span class="token-punctuation">]</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-9"><span class="token-punctuation">}</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-10"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-11"><span class="token-comment">// コメントはコメントとして認識する</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-keyword">const</span><span class="token-plain"> validationResult2 </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">validate</span><span class="token-punctuation">(</span><span class="token-template-punctuation">`</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-string">// eval(1+1);</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-template-punctuation">`</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-15"><span class="token-plain">assert</span><span class="token-punctuation">.</span><span class="token-method">deepStrictEqual</span><span class="token-punctuation">(</span><span class="token-plain">validationResult2</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-16"><span class="token-plain">    ok</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-boolean">true</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-17"><span class="token-plain">    errors</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-punctuation">]</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-18"><span class="token-punctuation">}</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div></div></code></pre><h4 class="cs-title css-1xose5o"><span>テスト</span></h4><p class="cs-subtitle css-fs2d1k" style="opacity:0"><span style="opacity:1"></span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-n2kuek" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xdak34" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-comment">// eval呼び出しを判定できてる</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-plain">    errors</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-punctuation">{</span><span class="token-plain"> text</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-string">&quot;eval(1+1)&quot;</span><span class="token-punctuation">,</span><span class="token-plain"> range</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-number">1</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-number">10</span><span class="token-punctuation">]</span><span class="token-plain"> </span><span class="token-punctuation">}</span><span class="token-punctuation">]</span></div></div><div></div></code></pre><h4 class="cs-title css-1xose5o"><span>テスト</span></h4><p class="cs-subtitle css-fs2d1k"><span style="opacity:1">evalを判定できてる</span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-n2kuek" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xdak34" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-comment">// eval呼び出しを判定できてる</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-plain">    errors</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-punctuation">{</span><span class="token-plain"> text</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-string">&quot;eval(1+1)&quot;</span><span class="token-punctuation">,</span><span class="token-plain"> range</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-number">1</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-number">10</span><span class="token-punctuation">]</span><span class="token-plain"> </span><span class="token-punctuation">}</span><span class="token-punctuation">]</span></div></div><div></div></code></pre><h4 class="cs-title css-1xose5o"><span>テスト</span></h4><p class="cs-subtitle css-fs2d1k"><span style="opacity:1">コメントを誤検知しない</span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-n2kuek" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xdak34" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-comment">// eval呼び出しを判定できてる</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-plain">    errors</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-punctuation">{</span><span class="token-plain"> text</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-string">&quot;eval(1+1)&quot;</span><span class="token-punctuation">,</span><span class="token-plain"> range</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-number">1</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-number">10</span><span class="token-punctuation">]</span><span class="token-plain"> </span><span class="token-punctuation">}</span><span class="token-punctuation">]</span></div></div><div></div></code></pre><h4 class="cs-title css-1xose5o" style="opacity:1"><span style="opacity:1">テスト</span></h4><p class="cs-subtitle css-fs2d1k" style="opacity:1"><span style="opacity:1">コメントは誤検知しない</span></p></div></div></div></div></div></div><div class="css-gxvojt"><h2 class="css-1djqpdg">no-eval: AST</h2><ul class="css-1uk1gs8"><li class="css-0">正規表現よりきっちりと対応できる(意図しない見逃しは減る)</li><li class="css-0">ツールやライブラリの一部として処理を組み込みやすい</li><li class="css-0">開発環境のツールチェインとして組み込むならESLintやBabelなどのエコシステムに乗せる</li></ul></div><div class="css-gxvojt"><h2 class="css-1djqpdg">no-eval: ESLint</h2></div><div class="css-gxvojt"><h2 class="css-1djqpdg">no-eval: ESLint</h2><ul class="css-1uk1gs8"><li class="css-0">ESLintのルールとしてno-evalを実装してみる<ul class="css-1uk1gs8"><li class="css-0"><a href="https://eslint.org/docs/rules/no-eval" class="css-199bzt4">公式版もある</a>けど今回はサンプルとして</li></ul></li><li class="css-0">ESLintは<a href="https://github.com/eslint/espree" class="css-199bzt4">Espree</a>をパーサとして使う<ul class="css-1uk1gs8"><li class="css-0"><a href="https://github.com/acornjs/acorn" class="css-199bzt4">Acorn</a>ベースだけど、ASTが<a href="https://github.com/estree/estree" class="css-199bzt4">ESTree</a>互換</li></ul></li><li class="css-0">トラバースはESLint側でやってくれるのでVisitorを書いていくだけ</li></ul></div><div class="css-gxvojt"><div style="width:100vw;max-width:100%;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center" class="cs-layout"><div style="overflow:auto;height:100%;width:100%"><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-plain">module</span><span class="token-punctuation">.</span><span class="token-property-access">exports</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-1"><span class="token-plain">    </span><span class="token-function-variable">create</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-parameter">context</span><span class="token-plain"> </span><span class="token-arrow">=&gt;</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">        </span><span class="token-keyword">return</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-plain">            </span><span class="token-string">&quot;CallExpression &gt; Identifier[name=eval]&quot;</span><span class="token-punctuation">(</span><span class="token-plain">node</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-4"><span class="token-plain">                context</span><span class="token-punctuation">.</span><span class="token-method">report</span><span class="token-punctuation">(</span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">                    message</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-string">&quot;Don&#x27;t use eval&quot;</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">                    node</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-7"><span class="token-plain">                </span><span class="token-punctuation">}</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-plain">            </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-9"><span class="token-plain">        </span><span class="token-punctuation">}</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-10"><span class="token-plain">    </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-11"><span class="token-punctuation">}</span><span class="token-punctuation">;</span></div></div><div></div></code></pre><h4 class="cs-title css-1q54swq" style="opacity:1"><span style="opacity:1">no-eval: ESLint</span></h4><p class="cs-subtitle css-fs2d1k" style="opacity:0"><span style="opacity:1"></span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-plain">            </span><span class="token-string">&quot;CallExpression &gt; Identifier[name=eval]&quot;</span><span class="token-punctuation">(</span><span class="token-plain">node</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">                    node</span></div></div><div></div></code></pre><p class="cs-subtitle css-fs2d1k"><span style="opacity:1">ESQueryでevalにマッチ</span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-plain">            </span><span class="token-string">&quot;CallExpression &gt; Identifier[name=eval]&quot;</span><span class="token-punctuation">(</span><span class="token-plain">node</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">                    node</span></div></div><div></div></code></pre><p class="cs-subtitle css-fs2d1k" style="opacity:1"><span style="opacity:1">evalのnodeをreportする</span></p></div></div></div></div></div><div class="css-gxvojt"><div style="width:100vw;max-width:100%;height:100vh;display:flex;flex-direction:row;justify-content:center;align-items:center;font-size:0.8em;position:relative" class="cs-col-layout"><div style="flex:1;overflow:hidden;height:100%"><div style="overflow:auto;height:100%;width:100%"><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-plain">module</span><span class="token-punctuation">.</span><span class="token-property-access">exports</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-1"><span class="token-plain">    </span><span class="token-function-variable">create</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-parameter">context</span><span class="token-plain"> </span><span class="token-arrow">=&gt;</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">        </span><span class="token-keyword">return</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-plain">            </span><span class="token-string">&quot;CallExpression &gt; Identifier[name=eval]&quot;</span><span class="token-punctuation">(</span><span class="token-plain">node</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-4"><span class="token-plain">                context</span><span class="token-punctuation">.</span><span class="token-method">report</span><span class="token-punctuation">(</span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">                    message</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-string">&quot;Don&#x27;t use eval&quot;</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">                    node</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-7"><span class="token-plain">                </span><span class="token-punctuation">}</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-plain">            </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-9"><span class="token-plain">        </span><span class="token-punctuation">}</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-10"><span class="token-plain">    </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-11"><span class="token-punctuation">}</span><span class="token-punctuation">;</span></div></div><div></div></code></pre><h4 class="cs-title css-1q54swq"><span>実装</span></h4></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-plain">            </span><span class="token-string">&quot;CallExpression &gt; Identifier[name=eval]&quot;</span><span class="token-punctuation">(</span><span class="token-plain">node</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">                    node</span></div></div><div></div></code></pre><h4 class="cs-title css-1q54swq"><span>実装</span></h4></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-plain">            </span><span class="token-string">&quot;CallExpression &gt; Identifier[name=eval]&quot;</span><span class="token-punctuation">(</span><span class="token-plain">node</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">                    node</span></div></div><div></div></code></pre><h4 class="cs-title css-1q54swq"><span>実装</span></h4></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-plain">            </span><span class="token-string">&quot;CallExpression &gt; Identifier[name=eval]&quot;</span><span class="token-punctuation">(</span><span class="token-plain">node</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">                    node</span></div></div><div></div></code></pre><h4 class="cs-title css-1q54swq"><span>実装</span></h4></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-plain">            </span><span class="token-string">&quot;CallExpression &gt; Identifier[name=eval]&quot;</span><span class="token-punctuation">(</span><span class="token-plain">node</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">                    node</span></div></div><div></div></code></pre><h4 class="cs-title css-1q54swq" style="opacity:1"><span style="opacity:1">実装</span></h4></div></div></div></div><div style="flex:1;overflow:hidden;height:100%"><div style="overflow:auto;height:100%;width:100%"><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-n2kuek" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xdak34" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-punctuation">{</span><span class="token-plain"> </span><span class="token-maybe-class-name">RuleTester</span><span class="token-plain"> </span><span class="token-punctuation">}</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">require</span><span class="token-punctuation">(</span><span class="token-string">&quot;eslint&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-1"><span class="token-keyword">const</span><span class="token-plain"> rule </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">require</span><span class="token-punctuation">(</span><span class="token-string">&quot;./no-eval&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-keyword">const</span><span class="token-plain"> tester </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-keyword">new</span><span class="token-plain"> </span><span class="token-class-name">RuleTester</span><span class="token-punctuation">(</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-4"><span class="token-plain">tester</span><span class="token-punctuation">.</span><span class="token-method">run</span><span class="token-punctuation">(</span><span class="token-string">&quot;no-eval&quot;</span><span class="token-punctuation">,</span><span class="token-plain"> rule</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">    valid</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">        </span><span class="token-template-punctuation">`</span><span class="token-string">new Function(&quot;return 1+1;&quot;)</span><span class="token-template-punctuation">`</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-7"><span class="token-plain">        </span><span class="token-template-punctuation">`</span><span class="token-string">// eval(&quot;1+1&quot;)</span><span class="token-template-punctuation">`</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-plain">    </span><span class="token-punctuation">]</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-9"><span class="token-plain">    invalid</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-10"><span class="token-plain">        </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-11"><span class="token-plain">            code</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-template-punctuation">`</span><span class="token-string">eval(1+1)</span><span class="token-template-punctuation">`</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-plain">            errors</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-punctuation">{</span><span class="token-plain"> message</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-string">&quot;Don&#x27;t use eval&quot;</span><span class="token-plain"> </span><span class="token-punctuation">}</span><span class="token-punctuation">]</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-plain">        </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-plain">    </span><span class="token-punctuation">]</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-15"><span class="token-punctuation">}</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div></div></code></pre><h4 class="cs-title css-1xose5o"><span>テスト</span></h4><p class="cs-subtitle css-fs2d1k" style="opacity:0"><span style="opacity:1"></span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-n2kuek" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xdak34" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">​</span></div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-plain">            errors</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-punctuation">{</span><span class="token-plain"> message</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-string">&quot;Don&#x27;t use eval&quot;</span><span class="token-plain"> </span><span class="token-punctuation">}</span><span class="token-punctuation">]</span></div></div><div></div></code></pre><h4 class="cs-title css-1xose5o"><span>テスト</span></h4><p class="cs-subtitle css-fs2d1k"><span style="opacity:1">RuleTesterを読み込む</span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-n2kuek" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xdak34" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">​</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-plain">            errors</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-punctuation">{</span><span class="token-plain"> message</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-string">&quot;Don&#x27;t use eval&quot;</span><span class="token-plain"> </span><span class="token-punctuation">}</span><span class="token-punctuation">]</span></div></div><div></div></code></pre><h4 class="cs-title css-1xose5o"><span>テスト</span></h4><p class="cs-subtitle css-fs2d1k"><span style="opacity:1">テストケースを書く</span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-n2kuek" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xdak34" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">​</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-plain">            errors</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-punctuation">{</span><span class="token-plain"> message</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-string">&quot;Don&#x27;t use eval&quot;</span><span class="token-plain"> </span><span class="token-punctuation">}</span><span class="token-punctuation">]</span></div></div><div></div></code></pre><h4 class="cs-title css-1xose5o"><span>テスト</span></h4><p class="cs-subtitle css-fs2d1k"><span style="opacity:1">valid:エラーじゃないパターン</span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-n2kuek" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xdak34" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-plain">            errors</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-punctuation">{</span><span class="token-plain"> message</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-string">&quot;Don&#x27;t use eval&quot;</span><span class="token-plain"> </span><span class="token-punctuation">}</span><span class="token-punctuation">]</span></div></div><div></div></code></pre><h4 class="cs-title css-1xose5o" style="opacity:1"><span style="opacity:1">テスト</span></h4><p class="cs-subtitle css-fs2d1k" style="opacity:1"><span style="opacity:1">invalid:エラーとなるパターン</span></p></div></div></div></div></div></div><div class="css-gxvojt"><h2 class="css-1djqpdg">no-eval: ESLint</h2><ul class="css-1uk1gs8"><li class="css-0">ESLintのルールはロジック部分のみ書く<ul class="css-1uk1gs8"><li class="css-0">パースやトラバースはESLint側でやってくれる</li><li class="css-0">プラグインの仕組み: <a href="https://efcl.info/2016/06/06/javascript-plugin-architecture/" class="css-199bzt4">JavaScript Plugin Architectureというプラグイン設計について学ぶ無料の電子書籍を書いた</a></li></ul></li><li class="css-0"><a href="https://github.com/estools/esquery" class="css-199bzt4">ESQuery</a>(CSS Query SelectorのAST版)や<a href="https://eslint.org/docs/developer-guide/working-with-rules" class="css-199bzt4">便利メソッド</a>が用意されている</li><li class="css-0">エディタやテストなどのツールチェインに組み込みたいときはESLintのルールとして書くと便利</li></ul></div><div class="css-gxvojt"><h2 class="css-1djqpdg">類似するAST Lintツール</h2><ul class="css-1uk1gs8"><li class="css-0">似た仕組みのLintツールが色々な言語向けにある<ul class="css-1uk1gs8"><li class="css-0">CSS: <a href="https://stylelint.io/" class="css-199bzt4">stylelint</a></li><li class="css-0">自然言語: <a href="https://textlint.github.io/" class="css-199bzt4">textlint</a></li></ul></li><li class="css-0">一度仕組みを覚えれば、いろんなツールのルールが作りやすくなる</li></ul></div><div class="css-gxvojt"><h1 class="css-1djqpdg">Transform</h1></div><div class="css-gxvojt"><h2 class="css-1djqpdg">Transform</h2><ul class="css-1uk1gs8"><li class="css-0">LintはNodeをチェックして報告するだけだったので簡単<ul class="css-1uk1gs8"><li class="css-0">コードをASTにパースして、ASTをチェックするだけ</li></ul></li><li class="css-0">コードを変換しようとすると、手書きは結構難しい<ul class="css-1uk1gs8"><li class="css-0">コードをASTにパースして、ASTを変換して、ASTをコードに戻す</li><li class="css-0">3ステップになる</li></ul></li></ul></div><div class="css-gxvojt"><h2 class="css-1djqpdg">Transform: Babel</h2><ul class="css-1uk1gs8"><li class="css-0">BabelはJavaScript ASTの変換プラットフォームとして使える</li><li class="css-0">Babel変換処理をプラグインとして実装できる</li></ul></div><div class="css-gxvojt"><h1 class="css-1djqpdg">no-console: Babel</h1><ul class="css-1uk1gs8"><li class="css-0">目的: <code class="css-vgof0f">console.log</code>をproductionビルドから取り除きたい</li><li class="css-0"><code class="css-vgof0f">console.log</code>を取り除く仕組みをBabelプラグインとして実装する</li><li class="css-0">BabelのパーサはBabel独自、トラバースはBabel側でやってくれる</li></ul></div><div class="css-gxvojt"><div style="width:100vw;max-width:100%;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center" class="cs-layout"><div style="overflow:auto;height:100%;width:100%"><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-plain">module</span><span class="token-punctuation">.</span><span class="token-method-variable">exports</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-1"><span class="token-plain">    </span><span class="token-keyword">return</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">        name</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-string">&quot;babel-plugin-no-console&quot;</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-plain">        visitor</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-4"><span class="token-plain">            </span><span class="token-maybe-class-name">CallExpression</span><span class="token-punctuation">(</span><span class="token-parameter">path</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">                </span><span class="token-comment">// path is wrapper of node + api</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">                </span><span class="token-keyword">const</span><span class="token-plain"> callee </span><span class="token-operator">=</span><span class="token-plain"> path</span><span class="token-punctuation">.</span><span class="token-property-access">node</span><span class="token-punctuation">.</span><span class="token-property-access">callee</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-7"><span class="token-plain">                </span><span class="token-keyword">const</span><span class="token-plain"> isConsole </span><span class="token-operator">=</span></div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-plain">                    callee</span><span class="token-punctuation">.</span><span class="token-property-access">type</span><span class="token-plain"> </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;MemberExpression&quot;</span><span class="token-plain"> </span><span class="token-operator">&amp;&amp;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-9"><span class="token-plain">                    callee</span><span class="token-punctuation">.</span><span class="token-property-access">object</span><span class="token-punctuation">.</span><span class="token-property-access">name</span><span class="token-plain"> </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;console&quot;</span><span class="token-plain"> </span><span class="token-operator">&amp;&amp;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-10"><span class="token-plain">                    callee</span><span class="token-punctuation">.</span><span class="token-property-access">property</span><span class="token-punctuation">.</span><span class="token-property-access">name</span><span class="token-plain"> </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;log&quot;</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-11"><span class="token-plain">                </span><span class="token-keyword">if</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-plain">isConsole</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-plain">                    </span><span class="token-keyword">return</span><span class="token-plain"> path</span><span class="token-punctuation">.</span><span class="token-method">remove</span><span class="token-punctuation">(</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-plain">                </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-plain">            </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-15"><span class="token-plain">        </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-16"><span class="token-plain">    </span><span class="token-punctuation">}</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-17"><span class="token-punctuation">}</span><span class="token-punctuation">;</span></div></div><div></div></code></pre><h4 class="cs-title css-1q54swq" style="opacity:1"><span style="opacity:1">no-console: Babel</span></h4><p class="cs-subtitle css-fs2d1k" style="opacity:0"><span style="opacity:1"></span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">                </span><span class="token-comment">// path is wrapper of node + api</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-plain">                    callee</span><span class="token-punctuation">.</span><span class="token-property-access">type</span><span class="token-plain"> </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;MemberExpression&quot;</span><span class="token-plain"> </span><span class="token-operator">&amp;&amp;</span></div></div><div></div></code></pre><p class="cs-subtitle css-fs2d1k"><span style="opacity:1">CallExpressionが来たときに呼ばれる関数</span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">                </span><span class="token-comment">// path is wrapper of node + api</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-plain">                    callee</span><span class="token-punctuation">.</span><span class="token-property-access">type</span><span class="token-plain"> </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;MemberExpression&quot;</span><span class="token-plain"> </span><span class="token-operator">&amp;&amp;</span></div></div><div></div></code></pre><p class="cs-subtitle css-fs2d1k"><span style="opacity:1">CallExpressionががconsole.logかを判定</span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">                </span><span class="token-comment">// path is wrapper of node + api</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-plain">                    callee</span><span class="token-punctuation">.</span><span class="token-property-access">type</span><span class="token-plain"> </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;MemberExpression&quot;</span><span class="token-plain"> </span><span class="token-operator">&amp;&amp;</span></div></div><div></div></code></pre><p class="cs-subtitle css-fs2d1k" style="opacity:1"><span style="opacity:1">console.logだったらpath.remove削除する</span></p></div></div></div></div></div><div class="css-gxvojt"><div style="width:100vw;max-width:100%;height:100vh;display:flex;flex-direction:row;justify-content:center;align-items:center;font-size:0.8em;position:relative" class="cs-col-layout"><div style="flex:1;overflow:hidden;height:100%"><div style="overflow:auto;height:100%;width:100%"><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-plain">module</span><span class="token-punctuation">.</span><span class="token-method-variable">exports</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-1"><span class="token-plain">    </span><span class="token-keyword">return</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">        name</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-string">&quot;babel-plugin-no-console&quot;</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-plain">        visitor</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-4"><span class="token-plain">            </span><span class="token-maybe-class-name">CallExpression</span><span class="token-punctuation">(</span><span class="token-parameter">path</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">                </span><span class="token-comment">// path is wrapper of node + api</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">                </span><span class="token-keyword">const</span><span class="token-plain"> callee </span><span class="token-operator">=</span><span class="token-plain"> path</span><span class="token-punctuation">.</span><span class="token-property-access">node</span><span class="token-punctuation">.</span><span class="token-property-access">callee</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-7"><span class="token-plain">                </span><span class="token-keyword">const</span><span class="token-plain"> isConsole </span><span class="token-operator">=</span></div></div><div style="overflow:hidden"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-plain">                    callee</span><span class="token-punctuation">.</span><span class="token-property-access">type</span><span class="token-plain"> </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;MemberExpression&quot;</span><span class="token-plain"> </span><span class="token-operator">&amp;&amp;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-9"><span class="token-plain">                    callee</span><span class="token-punctuation">.</span><span class="token-property-access">object</span><span class="token-punctuation">.</span><span class="token-property-access">name</span><span class="token-plain"> </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;console&quot;</span><span class="token-plain"> </span><span class="token-operator">&amp;&amp;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-10"><span class="token-plain">                    callee</span><span class="token-punctuation">.</span><span class="token-property-access">property</span><span class="token-punctuation">.</span><span class="token-property-access">name</span><span class="token-plain"> </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;log&quot;</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-11"><span class="token-plain">                </span><span class="token-keyword">if</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-plain">isConsole</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-plain">                    </span><span class="token-keyword">return</span><span class="token-plain"> path</span><span class="token-punctuation">.</span><span class="token-method">remove</span><span class="token-punctuation">(</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-plain">                </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-plain">            </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-15"><span class="token-plain">        </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-16"><span class="token-plain">    </span><span class="token-punctuation">}</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-17"><span class="token-punctuation">}</span><span class="token-punctuation">;</span></div></div><div></div></code></pre><h4 class="cs-title css-1q54swq"><span>実装</span></h4></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">                </span><span class="token-comment">// path is wrapper of node + api</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-plain">                    callee</span><span class="token-punctuation">.</span><span class="token-property-access">type</span><span class="token-plain"> </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;MemberExpression&quot;</span><span class="token-plain"> </span><span class="token-operator">&amp;&amp;</span></div></div><div></div></code></pre><h4 class="cs-title css-1q54swq" style="opacity:1"><span style="opacity:1">実装</span></h4></div></div></div></div><div style="flex:1;overflow:hidden;height:100%"><div style="overflow:auto;height:100%;width:100%"><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-n2kuek" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xdak34" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">const</span><span class="token-plain"> pluginTester </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">require</span><span class="token-punctuation">(</span><span class="token-string">&quot;babel-plugin-tester&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">.</span><span class="token-keyword">default</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-1"><span class="token-keyword">const</span><span class="token-plain"> plugin </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">require</span><span class="token-punctuation">(</span><span class="token-string">&quot;./index&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-function">pluginTester</span><span class="token-punctuation">(</span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-plain">    plugin</span><span class="token-punctuation">:</span><span class="token-plain"> plugin</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-4"><span class="token-plain">    tests</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span></div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">        </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">            code</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-template-punctuation">`</span><span class="token-string">console.log(1 + 1)</span><span class="token-template-punctuation">`</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-7"><span class="token-plain">            output</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-template-punctuation">`</span><span class="token-template-punctuation">`</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-plain">        </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-9"><span class="token-plain">    </span><span class="token-punctuation">]</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-10"><span class="token-punctuation">}</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div></div></code></pre><h4 class="cs-title css-1xose5o"><span>テスト</span></h4><p class="cs-subtitle css-fs2d1k" style="opacity:0"><span style="opacity:1"></span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-n2kuek" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xdak34" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">const</span><span class="token-plain"> pluginTester </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">require</span><span class="token-punctuation">(</span><span class="token-string">&quot;babel-plugin-tester&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">.</span><span class="token-keyword">default</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">        </span><span class="token-punctuation">{</span></div></div><div></div></code></pre><h4 class="cs-title css-1xose5o" style="opacity:1"><span style="opacity:1">テスト</span></h4><p class="cs-subtitle css-fs2d1k" style="opacity:1"><span style="opacity:1">入力に対する出力を書くテスト</span></p></div></div></div></div></div></div><div class="css-gxvojt"><h2 class="css-1djqpdg">Babel</h2><ul class="css-1uk1gs8"><li class="css-0">ASTの変換は結構泥臭い</li><li class="css-0">Babelは<code class="css-vgof0f">path</code>オブジェクトに便利メソッドをたくさん持っている<ul class="css-1uk1gs8"><li class="css-0"><code class="css-vgof0f">path.remove</code>でそのNodeを削除できる</li></ul></li><li class="css-0">先ほどのコードも <code class="css-vgof0f">matchesPattern</code> を使うともっと短く書ける</li></ul></div><div class="css-gxvojt"><div style="width:100vw;max-width:100%;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center" class="cs-layout"><div style="overflow:auto;height:100%;width:100%"><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-plain">module</span><span class="token-punctuation">.</span><span class="token-method-variable">exports</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-1"><span class="token-plain">    </span><span class="token-keyword">return</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">        name</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-string">&quot;babel-plugin-no-console&quot;</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-plain">        visitor</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-4"><span class="token-plain">            </span><span class="token-maybe-class-name">CallExpression</span><span class="token-punctuation">(</span><span class="token-parameter">path</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;transform:translateX(250px);height:0;opacity:0"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">                </span><span class="token-comment">// path has pattern match</span></div></div><div style="overflow:hidden;transform:translateX(250px);height:0;opacity:0"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">                </span><span class="token-keyword">const</span><span class="token-plain"> isConsole </span><span class="token-operator">=</span><span class="token-plain"> path</span><span class="token-punctuation">.</span><span class="token-method">get</span><span class="token-punctuation">(</span><span class="token-string">&#x27;callee&#x27;</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-plain">                </span><span class="token-comment">// path is wrapper of node + api</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-9"><span class="token-plain">                </span><span class="token-keyword">const</span><span class="token-plain"> callee </span><span class="token-operator">=</span><span class="token-plain"> path</span><span class="token-punctuation">.</span><span class="token-property-access">node</span><span class="token-punctuation">.</span><span class="token-property-access">callee</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-10"><span class="token-plain">                </span><span class="token-keyword">const</span><span class="token-plain"> isConsole </span><span class="token-operator">=</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-11"><span class="token-plain">                    callee</span><span class="token-punctuation">.</span><span class="token-property-access">type</span><span class="token-plain"> </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;MemberExpression&quot;</span><span class="token-plain"> </span><span class="token-operator">&amp;&amp;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-plain">                    callee</span><span class="token-punctuation">.</span><span class="token-property-access">object</span><span class="token-punctuation">.</span><span class="token-property-access">name</span><span class="token-plain"> </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;console&quot;</span><span class="token-plain"> </span><span class="token-operator">&amp;&amp;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-plain">                    callee</span><span class="token-punctuation">.</span><span class="token-property-access">property</span><span class="token-punctuation">.</span><span class="token-property-access">name</span><span class="token-plain"> </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;log&quot;</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-plain">                </span><span class="token-keyword">if</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-plain">isConsole</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-15"><span class="token-plain">                    </span><span class="token-keyword">return</span><span class="token-plain"> path</span><span class="token-punctuation">.</span><span class="token-method">remove</span><span class="token-punctuation">(</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-16"><span class="token-plain">                </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-17"><span class="token-plain">            </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-18"><span class="token-plain">        </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-19"><span class="token-plain">    </span><span class="token-punctuation">}</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-20"><span class="token-punctuation">}</span><span class="token-punctuation">;</span></div></div><div></div></code></pre><p class="cs-subtitle css-fs2d1k"><span style="opacity:1">先ほどの実装</span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">                </span><span class="token-comment">// path has pattern match</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">                </span><span class="token-keyword">const</span><span class="token-plain"> isConsole </span><span class="token-operator">=</span><span class="token-plain"> path</span><span class="token-punctuation">.</span><span class="token-method">get</span><span class="token-punctuation">(</span><span class="token-string">&#x27;callee&#x27;</span><span class="token-punctuation">)</span></div></div><div></div></code></pre><p class="cs-subtitle css-fs2d1k" style="opacity:1"><span style="opacity:1">matchesPatternを使う</span></p></div></div></div></div></div><div class="css-gxvojt"><h1 class="css-1djqpdg">Transform: 置換</h1><ul class="css-1uk1gs8"><li class="css-0">削除だけではなく別のものへの置換も簡単</li><li class="css-0"><code class="css-vgof0f">path.remove</code>ではなく<code class="css-vgof0f">path.replaceWith(node, arguments)</code>を使う</li><li class="css-0"><code class="css-vgof0f">babel-plugin-replace-console-log</code>を作ってみる<ul class="css-1uk1gs8"><li class="css-0"><code class="css-vgof0f">console.log(?)</code> を <code class="css-vgof0f">log(?)</code> に置き換える</li></ul></li></ul></div><div class="css-gxvojt"><div style="width:100vw;max-width:100%;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center" class="cs-layout"><div style="overflow:auto;height:100%;width:100%"><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">module</span><span class="token-punctuation">.</span><span class="token-method-variable">exports</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-plain">    </span><span class="token-keyword">return</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">        name</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-string">&quot;babel-plugin-no-console&quot;</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">        visitor</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-7"><span class="token-plain">            </span><span class="token-maybe-class-name">CallExpression</span><span class="token-punctuation">(</span><span class="token-parameter">path</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-plain">                </span><span class="token-comment">// path is wrapper of node + api</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-9"><span class="token-plain">                </span><span class="token-keyword">const</span><span class="token-plain"> callee </span><span class="token-operator">=</span><span class="token-plain"> path</span><span class="token-punctuation">.</span><span class="token-property-access">node</span><span class="token-punctuation">.</span><span class="token-property-access">callee</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-10"><span class="token-plain">                </span><span class="token-keyword">const</span><span class="token-plain"> isConsole </span><span class="token-operator">=</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-11"><span class="token-plain">                    callee</span><span class="token-punctuation">.</span><span class="token-property-access">type</span><span class="token-plain"> </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;MemberExpression&quot;</span><span class="token-plain"> </span><span class="token-operator">&amp;&amp;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-plain">                    callee</span><span class="token-punctuation">.</span><span class="token-property-access">object</span><span class="token-punctuation">.</span><span class="token-property-access">name</span><span class="token-plain"> </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;console&quot;</span><span class="token-plain"> </span><span class="token-operator">&amp;&amp;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-plain">                    callee</span><span class="token-punctuation">.</span><span class="token-property-access">property</span><span class="token-punctuation">.</span><span class="token-property-access">name</span><span class="token-plain"> </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;log&quot;</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-plain">                </span><span class="token-keyword">if</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-plain">isConsole</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;transform:translateX(250px);height:0;opacity:0"><div style="display:inline-block" class="cs-line cs-line-17"><span class="token-plain">                    path</span><span class="token-punctuation">.</span><span class="token-method">replaceWith</span><span class="token-punctuation">(</span><span class="token-plain">t</span><span class="token-punctuation">.</span><span class="token-maybe-class-name">CallExpression</span><span class="token-punctuation">(</span><span class="token-plain">t</span><span class="token-punctuation">.</span><span class="token-maybe-class-name">Identifier</span><span class="token-punctuation">(</span><span class="token-string">&quot;log&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">,</span><span class="token-plain"> originalArguments</span><span class="token-punctuation">)</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-18"><span class="token-plain">                    </span><span class="token-keyword">return</span><span class="token-plain"> path</span><span class="token-punctuation">.</span><span class="token-method">remove</span><span class="token-punctuation">(</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-19"><span class="token-plain">                </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-20"><span class="token-plain">            </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-21"><span class="token-plain">        </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-22"><span class="token-plain">    </span><span class="token-punctuation">}</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-23"><span class="token-punctuation">}</span><span class="token-punctuation">;</span></div></div><div></div></code></pre><p class="cs-subtitle css-fs2d1k"><span style="opacity:1">no-console</span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-plain">                </span><span class="token-comment">// path is wrapper of node + api</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-17"><span class="token-plain">                    path</span><span class="token-punctuation">.</span><span class="token-method">replaceWith</span><span class="token-punctuation">(</span><span class="token-plain">t</span><span class="token-punctuation">.</span><span class="token-maybe-class-name">CallExpression</span><span class="token-punctuation">(</span><span class="token-plain">t</span><span class="token-punctuation">.</span><span class="token-maybe-class-name">Identifier</span><span class="token-punctuation">(</span><span class="token-string">&quot;log&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">,</span><span class="token-plain"> originalArguments</span><span class="token-punctuation">)</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div></div></code></pre><p class="cs-subtitle css-fs2d1k" style="opacity:1"><span style="opacity:1">replace-console-with-log</span></p></div></div></div></div></div><div class="css-gxvojt"><div style="width:100vw;max-width:100%;height:100vh;display:flex;flex-direction:row;justify-content:center;align-items:center;font-size:0.8em;position:relative" class="cs-col-layout"><div style="flex:1;overflow:hidden;height:100%"><div style="overflow:auto;height:100%;width:100%"><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-plain">module</span><span class="token-punctuation">.</span><span class="token-method-variable">exports</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-parameter">babel</span><span class="token-plain"> </span><span class="token-arrow">=&gt;</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-1"><span class="token-plain">    </span><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-punctuation">{</span><span class="token-plain"> types</span><span class="token-punctuation">:</span><span class="token-plain"> t </span><span class="token-punctuation">}</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> babel</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">    </span><span class="token-keyword">return</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-plain">        name</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-string">&quot;babel-plugin-replace-console-log&quot;</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-4"><span class="token-plain">        visitor</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">            </span><span class="token-maybe-class-name">CallExpression</span><span class="token-punctuation">(</span><span class="token-parameter">path</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">                </span><span class="token-keyword">const</span><span class="token-plain"> callee </span><span class="token-operator">=</span><span class="token-plain"> path</span><span class="token-punctuation">.</span><span class="token-property-access">node</span><span class="token-punctuation">.</span><span class="token-property-access">callee</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-7"><span class="token-plain">                </span><span class="token-keyword">const</span><span class="token-plain"> isConsole </span><span class="token-operator">=</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-plain">                    callee</span><span class="token-punctuation">.</span><span class="token-property-access">type</span><span class="token-plain"> </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;MemberExpression&quot;</span><span class="token-plain"> </span><span class="token-operator">&amp;&amp;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-9"><span class="token-plain">                    callee</span><span class="token-punctuation">.</span><span class="token-property-access">object</span><span class="token-punctuation">.</span><span class="token-property-access">name</span><span class="token-plain"> </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;console&quot;</span><span class="token-plain"> </span><span class="token-operator">&amp;&amp;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-10"><span class="token-plain">                    callee</span><span class="token-punctuation">.</span><span class="token-property-access">property</span><span class="token-punctuation">.</span><span class="token-property-access">name</span><span class="token-plain"> </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;log&quot;</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-11"><span class="token-plain">                </span><span class="token-keyword">if</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-plain">isConsole</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-plain">                    </span><span class="token-comment">// replace `console.log` with `log`</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-plain">                    </span><span class="token-keyword">const</span><span class="token-plain"> originalArguments </span><span class="token-operator">=</span><span class="token-plain"> path</span><span class="token-punctuation">.</span><span class="token-property-access">node</span><span class="token-punctuation">.</span><span class="token-property-access">arguments</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-plain">                    path</span><span class="token-punctuation">.</span><span class="token-method">replaceWith</span><span class="token-punctuation">(</span><span class="token-plain">t</span><span class="token-punctuation">.</span><span class="token-maybe-class-name">CallExpression</span><span class="token-punctuation">(</span><span class="token-plain">t</span><span class="token-punctuation">.</span><span class="token-maybe-class-name">Identifier</span><span class="token-punctuation">(</span><span class="token-string">&quot;log&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">,</span><span class="token-plain"> originalArguments</span><span class="token-punctuation">)</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-15"><span class="token-plain">                </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-16"><span class="token-plain">            </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-17"><span class="token-plain">        </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-18"><span class="token-plain">    </span><span class="token-punctuation">}</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-19"><span class="token-punctuation">}</span><span class="token-punctuation">;</span></div></div><div></div></code></pre><h4 class="cs-title css-1q54swq"><span>実装</span></h4></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-plain">                    </span><span class="token-comment">// replace `console.log` with `log`</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-plain">                    path</span><span class="token-punctuation">.</span><span class="token-method">replaceWith</span><span class="token-punctuation">(</span><span class="token-plain">t</span><span class="token-punctuation">.</span><span class="token-maybe-class-name">CallExpression</span><span class="token-punctuation">(</span><span class="token-plain">t</span><span class="token-punctuation">.</span><span class="token-maybe-class-name">Identifier</span><span class="token-punctuation">(</span><span class="token-string">&quot;log&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">,</span><span class="token-plain"> originalArguments</span><span class="token-punctuation">)</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div></div></code></pre><h4 class="cs-title css-1q54swq" style="opacity:1"><span style="opacity:1">実装</span></h4></div></div></div></div><div style="flex:1;overflow:hidden;height:100%"><div style="overflow:auto;height:100%;width:100%"><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-n2kuek" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xdak34" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">const</span><span class="token-plain"> pluginTester </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">require</span><span class="token-punctuation">(</span><span class="token-string">&quot;babel-plugin-tester&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">.</span><span class="token-keyword">default</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-1"><span class="token-keyword">const</span><span class="token-plain"> plugin </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">require</span><span class="token-punctuation">(</span><span class="token-string">&quot;./index&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-function">pluginTester</span><span class="token-punctuation">(</span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-plain">    plugin</span><span class="token-punctuation">:</span><span class="token-plain"> plugin</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-4"><span class="token-plain">    tests</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span></div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">        </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">            code</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-template-punctuation">`</span><span class="token-string">console.log(1 + 1);</span><span class="token-template-punctuation">`</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-7"><span class="token-plain">            output</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-template-punctuation">`</span><span class="token-string">log(1 + 1);</span><span class="token-template-punctuation">`</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-plain">        </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-9"><span class="token-plain">    </span><span class="token-punctuation">]</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-10"><span class="token-punctuation">}</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div></div></code></pre><h4 class="cs-title css-1xose5o"><span>テスト</span></h4><p class="cs-subtitle css-fs2d1k" style="opacity:0"><span style="opacity:1"></span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-n2kuek" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xdak34" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">const</span><span class="token-plain"> pluginTester </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">require</span><span class="token-punctuation">(</span><span class="token-string">&quot;babel-plugin-tester&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">.</span><span class="token-keyword">default</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">        </span><span class="token-punctuation">{</span></div></div><div></div></code></pre><h4 class="cs-title css-1xose5o" style="opacity:1"><span style="opacity:1">テスト</span></h4><p class="cs-subtitle css-fs2d1k" style="opacity:1"><span style="opacity:1">置換されてる</span></p></div></div></div></div></div></div><div class="css-gxvojt"><h1 class="css-1djqpdg">Babel</h1><ul class="css-1uk1gs8"><li class="css-0">ドキュメントはいまいちだけど、ASTの便利メソッドがある<ul class="css-1uk1gs8"><li class="css-0">replace, remove, <a href="https://babeljs.io/docs/en/babel-template" class="css-199bzt4">template</a>, evaluate(静的に実行結果を計算)</li></ul></li></ul></div><div class="css-gxvojt"><div style="width:100vw;max-width:100%;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center" class="cs-layout"><div style="overflow:auto;height:100%;width:100%"><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-plain">module</span><span class="token-punctuation">.</span><span class="token-method-variable">exports</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-parameter">babel</span><span class="token-plain"> </span><span class="token-arrow">=&gt;</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">    </span><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-punctuation">{</span><span class="token-plain"> types</span><span class="token-punctuation">:</span><span class="token-plain"> t </span><span class="token-punctuation">}</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> babel</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-plain">    </span><span class="token-keyword">return</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-4"><span class="token-plain">        name</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-string">&quot;babel-plugin-replace-console-log&quot;</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">        visitor</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">            </span><span class="token-maybe-class-name">CallExpression</span><span class="token-punctuation">(</span><span class="token-parameter">path</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-9"><span class="token-plain">                </span><span class="token-keyword">const</span><span class="token-plain"> callee </span><span class="token-operator">=</span><span class="token-plain"> path</span><span class="token-punctuation">.</span><span class="token-property-access">node</span><span class="token-punctuation">.</span><span class="token-property-access">callee</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-10"><span class="token-plain">                </span><span class="token-keyword">const</span><span class="token-plain"> isConsole </span><span class="token-operator">=</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-11"><span class="token-plain">                    callee</span><span class="token-punctuation">.</span><span class="token-property-access">type</span><span class="token-plain"> </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;MemberExpression&quot;</span><span class="token-plain"> </span><span class="token-operator">&amp;&amp;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-plain">                    callee</span><span class="token-punctuation">.</span><span class="token-property-access">object</span><span class="token-punctuation">.</span><span class="token-property-access">name</span><span class="token-plain"> </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;console&quot;</span><span class="token-plain"> </span><span class="token-operator">&amp;&amp;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-plain">                    callee</span><span class="token-punctuation">.</span><span class="token-property-access">property</span><span class="token-punctuation">.</span><span class="token-property-access">name</span><span class="token-plain"> </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;log&quot;</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-plain">                </span><span class="token-keyword">if</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-plain">isConsole</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;transform:translateX(250px);height:0;opacity:0"><div style="display:inline-block" class="cs-line cs-line-15"><span class="token-plain">                    </span><span class="token-keyword">const</span><span class="token-plain"> build </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">template</span><span class="token-punctuation">(</span><span class="token-template-punctuation">`</span><span class="token-string">log(ARGUMENT)</span><span class="token-template-punctuation">`</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-20"><span class="token-plain">                    </span><span class="token-comment">// replace `console.log` with `log`</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-21"><span class="token-plain">                    </span><span class="token-keyword">const</span><span class="token-plain"> originalArguments </span><span class="token-operator">=</span><span class="token-plain"> path</span><span class="token-punctuation">.</span><span class="token-property-access">node</span><span class="token-punctuation">.</span><span class="token-property-access">arguments</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-22"><span class="token-plain">                    path</span><span class="token-punctuation">.</span><span class="token-method">replaceWith</span><span class="token-punctuation">(</span><span class="token-plain">t</span><span class="token-punctuation">.</span><span class="token-maybe-class-name">CallExpression</span><span class="token-punctuation">(</span><span class="token-plain">t</span><span class="token-punctuation">.</span><span class="token-maybe-class-name">Identifier</span><span class="token-punctuation">(</span><span class="token-string">&quot;log&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">,</span><span class="token-plain"> originalArguments</span><span class="token-punctuation">)</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-23"><span class="token-plain">                </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-24"><span class="token-plain">            </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-25"><span class="token-plain">        </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-26"><span class="token-plain">    </span><span class="token-punctuation">}</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-27"><span class="token-punctuation">}</span><span class="token-punctuation">;</span></div></div><div></div></code></pre><h4 class="cs-title css-1q54swq" style="opacity:1"><span style="opacity:1">今までの実装</span></h4><p class="cs-subtitle css-fs2d1k" style="opacity:0"><span style="opacity:1"></span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-15"><span class="token-plain">                    </span><span class="token-keyword">const</span><span class="token-plain"> build </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">template</span><span class="token-punctuation">(</span><span class="token-template-punctuation">`</span><span class="token-string">log(ARGUMENT)</span><span class="token-template-punctuation">`</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-20"><span class="token-plain">                    </span><span class="token-comment">// replace `console.log` with `log`</span></div></div><div></div></code></pre><p class="cs-subtitle css-fs2d1k" style="opacity:1"><span style="opacity:1">babel-templateを使った実装</span></p></div></div></div></div></div><div class="css-gxvojt"><h1 class="css-1djqpdg">Transform: jscodeshift</h1><ul class="css-1uk1gs8"><li class="css-0">Babel以外にもコードを変換するツールはある</li><li class="css-0"><a href="https://github.com/facebook/jscodeshift" class="css-199bzt4">jscodeshift</a></li><li class="css-0">Reactの<a href="https://github.com/facebook/codemod" class="css-199bzt4">codemod</a>などマイグレーションツールで使われる</li><li class="css-0">Babelはビルド向け、jscodeshiftはgrep+sedなどような大量のファイル変更向け</li><li class="css-0"><a href="https://github.com/facebook/jscodeshift" class="css-199bzt4">jscodeshift</a>も内部的にBabelのパーサを使う<ul class="css-1uk1gs8"><li class="css-0">JavaScriptやTypeScriptを処理できるため</li></ul></li></ul></div><div class="css-gxvojt"><h1 class="css-1djqpdg">Transform: jscodeshift</h1><ul class="css-1uk1gs8"><li class="css-0"><a href="https://github.com/facebook/jscodeshift" class="css-199bzt4">jscodeshift</a>はVisitorパターンではない</li><li class="css-0">jQueryやDOM APIようなコレクションAPIでASTを操作していく</li><li class="css-0">ESLint, Babel: トラバースの待ち受けを処理を書く(トップダウン)</li><li class="css-0">jscodeshift: 変換したいNodeを探して処理を書く(ボトムアップ)</li></ul></div><div class="css-gxvojt"><div style="width:100vw;max-width:100%;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center" class="cs-layout"><div style="overflow:auto;height:100%;width:100%"><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-plain">module</span><span class="token-punctuation">.</span><span class="token-method-variable">exports</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-keyword">function</span><span class="token-punctuation">(</span><span class="token-parameter">fileInfo</span><span class="token-punctuation">,</span><span class="token-parameter"> api</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-1"><span class="token-plain">    </span><span class="token-keyword">return</span><span class="token-plain"> api</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">        </span><span class="token-punctuation">.</span><span class="token-method">jscodeshift</span><span class="token-punctuation">(</span><span class="token-plain">fileInfo</span><span class="token-punctuation">.</span><span class="token-property-access">source</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-plain">        </span><span class="token-punctuation">.</span><span class="token-method">find</span><span class="token-punctuation">(</span><span class="token-string">&quot;CallExpression&quot;</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-4"><span class="token-plain">        </span><span class="token-punctuation">.</span><span class="token-method">filter</span><span class="token-punctuation">(</span><span class="token-parameter">path</span><span class="token-plain"> </span><span class="token-arrow">=&gt;</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">            </span><span class="token-comment">// babel&#x27;s path</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">            </span><span class="token-keyword">const</span><span class="token-plain"> callee </span><span class="token-operator">=</span><span class="token-plain"> path</span><span class="token-punctuation">.</span><span class="token-method">get</span><span class="token-punctuation">(</span><span class="token-string">&quot;callee&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-7"><span class="token-plain">            </span><span class="token-keyword">return</span><span class="token-plain"> </span><span class="token-punctuation">(</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-plain">                callee</span><span class="token-punctuation">.</span><span class="token-property-access">node</span><span class="token-punctuation">.</span><span class="token-property-access">type</span><span class="token-plain"> </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;MemberExpression&quot;</span><span class="token-plain"> </span><span class="token-operator">&amp;&amp;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-9"><span class="token-plain">                callee</span><span class="token-punctuation">.</span><span class="token-property-access">node</span><span class="token-punctuation">.</span><span class="token-property-access">object</span><span class="token-punctuation">.</span><span class="token-property-access">name</span><span class="token-plain"> </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;console&quot;</span><span class="token-plain"> </span><span class="token-operator">&amp;&amp;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-10"><span class="token-plain">                callee</span><span class="token-punctuation">.</span><span class="token-property-access">property</span><span class="token-punctuation">.</span><span class="token-property-access">name</span><span class="token-plain"> </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;log&quot;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-11"><span class="token-plain">            </span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-plain">        </span><span class="token-punctuation">}</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-plain">        </span><span class="token-punctuation">.</span><span class="token-method">replaceWith</span><span class="token-punctuation">(</span><span class="token-parameter">path</span><span class="token-plain"> </span><span class="token-arrow">=&gt;</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-plain">            </span><span class="token-keyword">const</span><span class="token-plain"> t </span><span class="token-operator">=</span><span class="token-plain"> api</span><span class="token-punctuation">.</span><span class="token-property-access">jscodeshift</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-15"><span class="token-plain">            </span><span class="token-keyword">const</span><span class="token-plain"> originalArguments </span><span class="token-operator">=</span><span class="token-plain"> path</span><span class="token-punctuation">.</span><span class="token-property-access">node</span><span class="token-punctuation">.</span><span class="token-property-access">arguments</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-16"><span class="token-plain">            </span><span class="token-keyword">return</span><span class="token-plain"> t</span><span class="token-punctuation">.</span><span class="token-method">callExpression</span><span class="token-punctuation">(</span><span class="token-plain">t</span><span class="token-punctuation">.</span><span class="token-method">identifier</span><span class="token-punctuation">(</span><span class="token-string">&quot;log&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">,</span><span class="token-plain"> originalArguments</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-17"><span class="token-plain">        </span><span class="token-punctuation">}</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-18"><span class="token-plain">        </span><span class="token-punctuation">.</span><span class="token-method">toSource</span><span class="token-punctuation">(</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-19"><span class="token-punctuation">}</span><span class="token-punctuation">;</span></div></div><div></div></code></pre><h4 class="cs-title css-1q54swq" style="opacity:1"><span style="opacity:1">replace-console-with-log</span></h4><p class="cs-subtitle css-fs2d1k" style="opacity:0"><span style="opacity:1"></span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">            </span><span class="token-comment">// babel&#x27;s path</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-16"><span class="token-plain">            </span><span class="token-keyword">return</span><span class="token-plain"> t</span><span class="token-punctuation">.</span><span class="token-method">callExpression</span><span class="token-punctuation">(</span><span class="token-plain">t</span><span class="token-punctuation">.</span><span class="token-method">identifier</span><span class="token-punctuation">(</span><span class="token-string">&quot;log&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">,</span><span class="token-plain"> originalArguments</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div></div></code></pre><p class="cs-subtitle css-fs2d1k"><span style="opacity:1">ソースを読む</span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">            </span><span class="token-comment">// babel&#x27;s path</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-16"><span class="token-plain">            </span><span class="token-keyword">return</span><span class="token-plain"> t</span><span class="token-punctuation">.</span><span class="token-method">callExpression</span><span class="token-punctuation">(</span><span class="token-plain">t</span><span class="token-punctuation">.</span><span class="token-method">identifier</span><span class="token-punctuation">(</span><span class="token-string">&quot;log&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">,</span><span class="token-plain"> originalArguments</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div></div></code></pre><p class="cs-subtitle css-fs2d1k"><span style="opacity:1">CallExpressionを探す</span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">            </span><span class="token-comment">// babel&#x27;s path</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-16"><span class="token-plain">            </span><span class="token-keyword">return</span><span class="token-plain"> t</span><span class="token-punctuation">.</span><span class="token-method">callExpression</span><span class="token-punctuation">(</span><span class="token-plain">t</span><span class="token-punctuation">.</span><span class="token-method">identifier</span><span class="token-punctuation">(</span><span class="token-string">&quot;log&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">,</span><span class="token-plain"> originalArguments</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div></div></code></pre><p class="cs-subtitle css-fs2d1k"><span style="opacity:1">CallExpressionがconsole.logだけに絞る</span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">            </span><span class="token-comment">// babel&#x27;s path</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-16"><span class="token-plain">            </span><span class="token-keyword">return</span><span class="token-plain"> t</span><span class="token-punctuation">.</span><span class="token-method">callExpression</span><span class="token-punctuation">(</span><span class="token-plain">t</span><span class="token-punctuation">.</span><span class="token-method">identifier</span><span class="token-punctuation">(</span><span class="token-string">&quot;log&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">,</span><span class="token-plain"> originalArguments</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div></div></code></pre><p class="cs-subtitle css-fs2d1k"><span style="opacity:1">console.logをlogに置換する</span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">            </span><span class="token-comment">// babel&#x27;s path</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-16"><span class="token-plain">            </span><span class="token-keyword">return</span><span class="token-plain"> t</span><span class="token-punctuation">.</span><span class="token-method">callExpression</span><span class="token-punctuation">(</span><span class="token-plain">t</span><span class="token-punctuation">.</span><span class="token-method">identifier</span><span class="token-punctuation">(</span><span class="token-string">&quot;log&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">,</span><span class="token-plain"> originalArguments</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div></div></code></pre><p class="cs-subtitle css-fs2d1k"><span style="opacity:1">変換結果をソースに戻す</span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">            </span><span class="token-comment">// babel&#x27;s path</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-16"><span class="token-plain">            </span><span class="token-keyword">return</span><span class="token-plain"> t</span><span class="token-punctuation">.</span><span class="token-method">callExpression</span><span class="token-punctuation">(</span><span class="token-plain">t</span><span class="token-punctuation">.</span><span class="token-method">identifier</span><span class="token-punctuation">(</span><span class="token-string">&quot;log&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">,</span><span class="token-plain"> originalArguments</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div></div></code></pre><p class="cs-subtitle css-fs2d1k" style="opacity:1"><span style="opacity:1">console.log -&gt; log</span></p></div></div></div></div></div></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/print";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-36d5cee86ff0038b4e7b.js"],"component---gatsby-theme-mdx-deck-src-templates-deck-js":["/component---gatsby-theme-mdx-deck-src-templates-deck-js-dd8d20199831c7ac1b73.js"]};/*]]>*/</script><script src="/component---gatsby-theme-mdx-deck-src-templates-deck-js-dd8d20199831c7ac1b73.js" async=""></script><script src="/app-36d5cee86ff0038b4e7b.js" async=""></script><script src="/commons-317f25377a27bed135ec.js" async=""></script><script src="/webpack-runtime-644e2f57be4c854484be.js" async=""></script></body></html>